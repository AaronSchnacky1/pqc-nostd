name: Rust Tests

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: dtolnay/rust-toolchain@stable
      with:
        toolchain: stable
        components: rustfmt, clippy

    - name: Run tests (no default features)
      run: cargo test --no-default-features

    - name: Run tests (with alloc feature)
      run: cargo test --no-default-features --features alloc

    - name: Run tests (with alloc and aes-gcm features)
      run: cargo test --no-default-features --features "alloc,aes-gcm"